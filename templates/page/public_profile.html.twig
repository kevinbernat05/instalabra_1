<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Perfil de {{ usuario.nombre }}</title>
    <link rel="stylesheet" href="{{ asset('css/app.css') }}">
</head>
<body>
    <header>
        <h1>Perfil de {{ usuario.nombre }}</h1>
        <nav>
            <ul>
                <li><a href="{{ path('app_home') }}">Inicio</a></li>
                {% if app.user %}
                    <li><a href="{{ path('app_logout') }}">Cerrar sesi√≥n</a></li>
                    <li><a href="{{ path('perfil_editar') }}">Mi perfil</a></li>
                {% else %}
                    <li><a href="{{ path('app_login') }}">Iniciar sesi√≥n</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>

    <main>
        <section class="foto-perfil">
            <h2>{{ usuario.nombre }}</h2>
            <img src="{{ usuario.fotoPerfil ? asset('uploads/perfiles/' ~ usuario.fotoPerfil) : asset('images/default-profile.png') }}"
                 alt="Foto de {{ usuario.nombre }}" width="150" height="150" style="border-radius:50%;">
            
            <div style="margin-bottom: 20px;">
                <p>
                   <strong>Seguidores:</strong> {{ followersCount }} | 
                   <strong>Seguidos:</strong> {{ followingCount }}
                </p>
            </div>

            {% if app.user and app.user != usuario %}
                <div style="margin-top: 10px;">
                    {% if isFollowing %}
                         <a href="{{ path('app_usuario_follow', {id: usuario.id}) }}"><button>Dejar de seguir</button></a>
                    {% else %}
                         <a href="{{ path('app_usuario_follow', {id: usuario.id}) }}"><button>Seguir</button></a>
                    {% endif %}
                </div>
            {% endif %}
        </section>

        <hr>

        <section class="palabras">
            <h2>Palabras publicadas</h2>

            {% if palabras|length > 0 %}
                {% for palabra in palabras %}
                    <div class="palabra">
                        <p>
                            <a href="{{ path('palabra_show', { id: palabra.id }) }}" class="palabra-link">
                                {{ palabra.texto }}
                            </a>
                        </p>
                        <small>{{ palabra.fechaCreacion|date('d/m/Y H:i') }}</small>

                        {% if app.user %}
                            <form action="{{ path('palabra_like_toggle', {'id': palabra.id}) }}" method="post" style="display:inline;">
                                {% set liked = palabra.valoraciones|filter(v => v.usuario.id == app.user.id and v.likeActiva)|length %}
                                <button type="submit">
                                    {% if liked %}üíñ Ya te gusta{% else %}üëç Like{% endif %}
                                </button>
                            </form>

                            <button type="button" onclick="window.location.href='{{ path('palabra_show', { id: palabra.id }) }}'">
                                üí¨ Comentarios ({{ palabra.comentarios|length }})
                            </button>
                        {% else %}
                             <p>üëç Likes: {{ palabra.valoraciones|filter(v => v.likeActiva)|length }}</p>
                        {% endif %}
                    </div>
                {% endfor %}
            {% else %}
                <p>Este usuario no ha publicado ninguna palabra.</p>
            {% endif %}
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Instalabra</p>
    </footer>
</body>
</html>
