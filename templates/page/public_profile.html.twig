{% extends 'base.html.twig' %}

{% block title %}Perfil de
	{{ usuario.nombre }}
{% endblock %}

{% block body %}
	<section class="foto-perfil">
		<h2>{{ usuario.nombre }}</h2>
		<img src="{{ usuario.fotoPerfil ? asset('uploads/perfiles/' ~ usuario.fotoPerfil) : asset('multimedia/Prueba/noicon.jpg') }}" alt="Foto de {{ usuario.nombre }}" width="150" height="150">

		<div>
			<p>
				<strong>Seguidores:</strong>
				{{ followersCount }}
				|
				<strong>Seguidos:</strong>
				{{ followingCount }}
			</p>
		</div>

		{% if app.user and app.user != usuario %}
			<div>
				{% if isFollowing %}
					<a href="{{ path('app_usuario_follow', {id: usuario.id}) }}" class="ajax-follow-link">
						<button>Dejar de seguir</button>
					</a>
				{% else %}
					<a href="{{ path('app_usuario_follow', {id: usuario.id}) }}" class="ajax-follow-link">
						<button>Seguir</button>
					</a>
				{% endif %}

				<a href="{{ path('app_chat_show', {id: usuario.id}) }}">
					<button>Enviar mensaje</button>
				</a>

				{% if is_granted('ROLE_ADMIN') %}
					<a href="{{ path('admin_user_toggle_block', {id: usuario.id}) }}" class="btn {{ usuario.isBlocked ? 'btn-warning' : 'btn-danger' }}" style="text-decoration:none;">
						<button style="background-color: {{ usuario.isBlocked ? '#ffcc00' : '#ff4444' }}; color: white; border: none;">
							{{ usuario.isBlocked ? 'Desbloquear Usuario' : 'Bloquear Usuario' }}
						</button>
					</a>
				{% endif %}
			</div>
		{% endif %}
	</section>

	<hr>

	<section class="palabras">
		<h2>Palabras publicadas</h2>

		{% if palabras|length > 0 %}
			{% for palabra in palabras %}
				<div class="palabra">
					<p>
						<a href="{{ path('palabra_show', { id: palabra.id }) }}" class="palabra-link">
							{{ palabra.palabra }}
						</a>
					</p>
					<p>{{ palabra.definicion }}</p>
					<small>{{ palabra.fechaCreacion|date('d/m/Y H:i') }}</small>

					{% if app.user %}
						<form action="{{ path('palabra_like_toggle', {'id': palabra.id}) }}" method="post" class="ajax-like-form">
							{% set liked = palabra.valoraciones|filter(v => v.usuario.id == app.user.id and v.likeActiva)|length %}
							<button type="submit">
								{% if liked %}üíñ Ya te gusta{% else %}üëç Like
								{% endif %}
							</button>
						</form>

						<button type="button" onclick="window.location.href='{{ path('palabra_show', { id: palabra.id }) }}'">
							üí¨ Comentarios ({{ palabra.comentarios|length }})
						</button>
					{% else %}
						<p>üëç Likes:
							{{ palabra.valoraciones|filter(v => v.likeActiva)|length }}</p>
					{% endif %}
				</div>
			{% endfor %}
		{% else %}
			<p>Este usuario no ha publicado ninguna palabra.</p>
		{% endif %}
	</section>
{% endblock %}
