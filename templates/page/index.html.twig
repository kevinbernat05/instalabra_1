{% extends 'base.html.twig' %}

{% block title %}Inicio - Instalabra
{% endblock %}

{% block body %}
	<h2>Publica tu palabra</h2>

	{% if app.user %}
		{{ form_start(form) }}
		{{ form_row(form.texto, {'attr': {'placeholder': 'Escribe tu palabra...', 'rows': 3}}) }}
		<button type="submit">Publicar</button>
		{{ form_end(form) }}
	{% else %}
		<p>Debes
			<a href="{{ path('app_login') }}">iniciar sesi贸n</a>
			para publicar.</p>
	{% endif %}

	<h2>Feed de palabras</h2>
	{% for palabra in palabras %}
		<div class="palabra">
			<p>
				<img src="{{ palabra.usuario.fotoPerfil ? asset('uploads/perfiles/' ~ palabra.usuario.fotoPerfil) : asset('images/default-profile.png') }}" alt="Foto de {{ palabra.usuario.nombre }}" width="30" height="30" style="border-radius:50%; vertical-align: middle; margin-right: 5px;">
				<strong>{{ palabra.usuario.nombre }}</strong>
			</p>
			<p>
				<a href="{{ path('palabra_show', { id: palabra.id }) }}" class="palabra-link">
					{{ palabra.texto }}
				</a>
			</p>
			<small>{{ palabra.fechaCreacion|date('d/m/Y H:i') }}</small>

			{% if app.user %}
				<form action="{{ path('palabra_like_toggle', {'id': palabra.id}) }}" method="post" style="display:inline;">
					{% set liked = palabra.valoraciones|filter(v => v.usuario.id == app.user.id and v.likeActiva)|length %}
					<button type="submit">
						{% if liked %} Ya te gusta ({{ palabra.valoraciones|filter(v => v.likeActiva)|length }}){% else %} Like ({{ palabra.valoraciones|filter(v => v.likeActiva)|length }})
						{% endif %}
					</button>
				</form>

				{# Bot贸n de Comentarios #}
				<button type="button" onclick="window.location.href='{{ path('palabra_show', { id: palabra.id }) }}'">
					 Comentarios ({{ palabra.comentarios|length }})
				</button>

				{# Bot贸n de Eliminar #}
				{% if app.user == palabra.usuario %}
					<form method="post" action="{{ path('palabra_delete', {id: palabra.id}) }}" onsubmit="return confirm('驴Eliminar auto-publicaci贸n?');" style="display:inline; margin-left: 10px;">
						<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ palabra.id) }}">
						<button type="submit" style="color:red;">[Eliminar]</button>
					</form>
				{% endif %}
			{% endif %}
		</div>
		------------------------------------------------
	{% else %}
		<p>No hay palabras publicadas todav铆a.</p>
	{% endfor %}
{% endblock %}
