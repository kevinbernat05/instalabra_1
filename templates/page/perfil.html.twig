{% extends 'base.html.twig' %}

{% block title %}Perfil de {{ usuario.nombre }}{% endblock %}

{% block body %}
    <section class="foto-perfil">
        <h2>Foto de perfil</h2>
        <img src="{{ usuario.fotoPerfil ? asset('uploads/perfiles/' ~ usuario.fotoPerfil) : asset('images/default-profile.png') }}"
                alt="Foto de {{ usuario.nombre }}" width="150" height="150" style="border-radius:50%;">
    <h2>Mis palabras publicadas</h2>
    
    <div style="margin-bottom: 20px;">
            <p>
            <strong>Seguidores:</strong> {{ usuario.seguimientosQueRecibe|length }} | 
            <strong>Seguidos:</strong> {{ usuario.seguimientosQueHace|length }}
            </p>
    </div>

        {% if app.user and app.user.id == usuario.id %}
            <a href="{{ path('perfil_editar') }}">
                <button>Editar foto de perfil</button>
            </a>
        {% endif %}
    </section>

    <hr>

    <section class="palabras">
        <h2>Mis palabras publicadas</h2>

        {% if palabras|length > 0 %}
            {% for palabra in palabras %}
                <div class="palabra">
                    {# Nombre de la palabra como link a su p치gina #}
                    <p>
                        <a href="{{ path('palabra_show', { id: palabra.id }) }}" class="palabra-link">
                            {{ palabra.texto }}
                        </a>
                    </p>
                    <small>{{ palabra.fechaCreacion|date('d/m/Y H:i') }}</small>

                    {% if app.user %}
                        {# Bot칩n de Like #}
                        <form action="{{ path('palabra_like_toggle', {'id': palabra.id}) }}" method="post" style="display:inline;">
                            {% set liked = palabra.valoraciones|filter(v => v.usuario.id == app.user.id and v.likeActiva)|length %}
                            <button type="submit">
                                {% if liked %}游눘 Ya te gusta{% else %}游녨 Like{% endif %}
                            </button>
                        </form>

                        {# Bot칩n de Comentarios (lleva a la p치gina de la palabra) #}
                        <button type="button" onclick="window.location.href='{{ path('palabra_show', { id: palabra.id }) }}'">
                            游눫 Comentarios ({{ palabra.comentarios|length }})
                        </button>
                    {% else %}
                        <p>游녨 Likes: {{ palabra.valoraciones|filter(v => v.likeActiva)|length }}</p>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <p>A칰n no has publicado ninguna palabra.</p>
        {% endif %}
    </section>
{% endblock %}
